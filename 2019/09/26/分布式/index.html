<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>分布式 | mikasaco</title><meta name="description" content="分布式"><meta name="keywords" content="分布式锁,分布式事务"><meta name="author" content="mikasa"><meta name="copyright" content="mikasa"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/bug.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://www.shenlinqiang.com/2019/09/26/分布式/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="分布式"><meta name="twitter:description" content="分布式"><meta name="twitter:image" content="http://www.shenlinqiang.com/images/iterator.jpg"><meta property="og:type" content="article"><meta property="og:title" content="分布式"><meta property="og:url" content="http://www.shenlinqiang.com/2019/09/26/分布式/"><meta property="og:site_name" content="mikasaco"><meta property="og:description" content="分布式"><meta property="og:image" content="http://www.shenlinqiang.com/images/iterator.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="源码解读-Map" href="http://www.shenlinqiang.com/2019/10/08/源码解读-Map/"><link rel="next" title="源码解读-迭代器" href="http://www.shenlinqiang.com/2019/09/17/源码解读-迭代器/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false
  
}</script></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">mikasaco</a></span><i class="fa fa-bars fa-fw toggle-menu pull-right close" aria-hidden="true"></i><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lozad avatar_img" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/Photo/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">46</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">91</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">57</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><script>document.body.addEventListener('touchstart', function(){ });</script></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#分布式锁"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">分布式锁</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#使用场景"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">使用场景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#实现方式"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">实现方式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#MySQL"><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">MySQL</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Zookeeper"><span class="toc_mobile_items-number">1.2.2.</span> <span class="toc_mobile_items-text">Zookeeper</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#方案一"><span class="toc_mobile_items-number">1.2.2.1.</span> <span class="toc_mobile_items-text">方案一</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#方案二"><span class="toc_mobile_items-number">1.2.2.2.</span> <span class="toc_mobile_items-text">方案二</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Redis"><span class="toc_mobile_items-number">1.2.3.</span> <span class="toc_mobile_items-text">Redis</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#setnx"><span class="toc_mobile_items-number">1.2.3.1.</span> <span class="toc_mobile_items-text">setnx</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#setnx-setex"><span class="toc_mobile_items-number">1.2.3.2.</span> <span class="toc_mobile_items-text">setnx+setex</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#set-nx-ex"><span class="toc_mobile_items-number">1.2.3.3.</span> <span class="toc_mobile_items-text">set nx ex</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#redlock"><span class="toc_mobile_items-number">1.2.3.4.</span> <span class="toc_mobile_items-text">redlock</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#分布式事务"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">分布式事务</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#两阶段提交-强一致"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">两阶段提交(强一致)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#TCC-强一致"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">TCC(强一致)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#可靠消息最终一致性-最终一致"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">可靠消息最终一致性(最终一致)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#项目中的思考"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">项目中的思考</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式锁"><span class="toc-number">1.</span> <span class="toc-text">分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用场景"><span class="toc-number">1.1.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现方式"><span class="toc-number">1.2.</span> <span class="toc-text">实现方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL"><span class="toc-number">1.2.1.</span> <span class="toc-text">MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zookeeper"><span class="toc-number">1.2.2.</span> <span class="toc-text">Zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#方案一"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">方案一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方案二"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">方案二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-number">1.2.3.</span> <span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setnx"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">setnx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setnx-setex"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">setnx+setex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-nx-ex"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">set nx ex</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redlock"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">redlock</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式事务"><span class="toc-number">2.</span> <span class="toc-text">分布式事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#两阶段提交-强一致"><span class="toc-number">2.1.</span> <span class="toc-text">两阶段提交(强一致)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCC-强一致"><span class="toc-number">2.2.</span> <span class="toc-text">TCC(强一致)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可靠消息最终一致性-最终一致"><span class="toc-number">2.3.</span> <span class="toc-text">可靠消息最终一致性(最终一致)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目中的思考"><span class="toc-number">2.4.</span> <span class="toc-text">项目中的思考</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/images/iterator.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">分布式</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-09-26<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-03-05</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/分布式/">分布式</a></span><div class="post-meta-wordcount"></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="&#x5206;&#x5E03;&#x5F0F;&#x9501;"><a href="#&#x5206;&#x5E03;&#x5F0F;&#x9501;" class="headerlink" title="&#x5206;&#x5E03;&#x5F0F;&#x9501;"></a>&#x5206;&#x5E03;&#x5F0F;&#x9501;</h1><h2 id="&#x4F7F;&#x7528;&#x573A;&#x666F;"><a href="#&#x4F7F;&#x7528;&#x573A;&#x666F;" class="headerlink" title="&#x4F7F;&#x7528;&#x573A;&#x666F;"></a>&#x4F7F;&#x7528;&#x573A;&#x666F;</h2><p>&#x5F53;&#x591A;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x8981;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x516C;&#x5171;&#x8D44;&#x6E90;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x5355;&#x673A;&#x7684;&#x52A0;&#x9501;&#x65B9;&#x5F0F;&#xFF08;synchronized&#x3001;Lock&#xFF09;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#x4E0D;&#x80FD;&#x53D1;&#x6325;&#x4F5C;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x624D;&#x6709;&#x4E86;&#x5206;&#x5E03;&#x5F0F;&#x9501;&#x3002;</p>
<h2 id="&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"><a href="#&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;" class="headerlink" title="&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"></a>&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><ul>
<li><p>&#x5B9E;&#x73B0;&#x539F;&#x7406;</p>
<p>&#x5E42;&#x7B49;&#x6027;&#x6821;&#x9A8C;&#xFF0C;&#x628A;&#x67E5;&#x8BE2;&#x548C;&#x63D2;&#x5165;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x67E5;&#x8BE2;&#x4E3A; null &#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x63D2;&#x5165;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#xFF0C;&#x522B;&#x7684;&#x670D;&#x52A1;&#x5C31;&#x4E0D;&#x80FD;&#xFF08;&#x6CA1;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF09;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addOrderRecord</span><span class="params">(Order order)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(orderDao.selectOrderRecord(order)==<span class="keyword">null</span>){</span><br><span class="line">    <span class="keyword">int</span> result = orderDao.addOrderRecord(order);</span><br><span class="line">    <span class="keyword">if</span>(result&gt;<span class="number">0</span>){</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x7F3A;&#x70B9;</p>
<ol>
<li>&#x6027;&#x80FD;&#x5DEE;&#xFF0C;&#x7528;&#x4E8E;&#x4F4E;&#x5E76;&#x53D1;&#x3001;&#x6027;&#x80FD;&#x8981;&#x6C42;&#x4F4E;&#x7684;&#x573A;&#x666F;&#xFF1B;</li>
<li>&#x6709;&#x5355;&#x70B9;&#x6545;&#x969C;&#x95EE;&#x9898;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x4E0D;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5C31;&#x9020;&#x6210;&#x4E86;&#x6B7B;&#x9501;&#x3002;</li>
</ol>
</li>
</ul>
<h3 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h3><ul>
<li><p>&#x5B9E;&#x73B0;&#x539F;&#x7406;</p>
<p>&#x5229;&#x7528; zk &#x7684;&#x8282;&#x70B9;&#x521B;&#x5EFA;&#x548C;&#x76D1;&#x542C;&#x8282;&#x70B9;&#x5220;&#x9664;&#x7684;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x591A;&#x4E2A;&#x7CFB;&#x7EDF;&#x540C;&#x65F6;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x521B;&#x5EFA;&#x6210;&#x529F;&#x3002;</p>
</li>
</ul>
<h4 id="&#x65B9;&#x6848;&#x4E00;"><a href="#&#x65B9;&#x6848;&#x4E00;" class="headerlink" title="&#x65B9;&#x6848;&#x4E00;"></a>&#x65B9;&#x6848;&#x4E00;</h4><p>&#x540C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x53EA;&#x80FD;&#x521B;&#x5EFA;&#x4E00;&#x6B21;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x52A0;&#x9501;&#x65F6;&#x68C0;&#x6D4B;&#x8282;&#x70B9;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x5219;&#x521B;&#x5EFA;&#x4E4B;&#xFF0C;&#x5B58;&#x5728;&#x6216;&#x8005;&#x521B;&#x5EFA;&#x5931;&#x8D25;&#x5219;&#x76D1;&#x542C;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x5F53;&#x91CA;&#x653E;&#x9501;&#x7684;&#x65F6;&#x5019;&#x76D1;&#x542C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x518D;&#x6B21;&#x7ADE;&#x4E89;&#x53BB;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x6210;&#x529F;&#x7684;&#x5219;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x4E0D;&#x6210;&#x529F;&#x7684;&#x5219;&#x518D;&#x6B21;&#x76D1;&#x542C;&#x8BE5;&#x8282;&#x70B9;&#x3002;</p>
<table>
<thead>
<tr>
<th>&#x65F6;&#x523B;</th>
<th>&#x7EBF;&#x7A0B;1</th>
<th>&#x7EBF;&#x7A0B;2</th>
<th>&#x7EBF;&#x7A0B;3</th>
</tr>
</thead>
<tbody><tr>
<td>t1</td>
<td>&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8282;&#x70B9; /lock&#xFF08;&#x6210;&#x529F;&#xFF09;</td>
<td>&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8282;&#x70B9; /lock&#xFF08;&#x5931;&#x8D25;&#xFF09;</td>
<td></td>
</tr>
<tr>
<td>t2</td>
<td>&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x6267;&#x884C;&#x9501;&#x5185;&#x4E1A;&#x52A1;</td>
<td>&#x76D1;&#x542C; /lock &#x8282;&#x70B9;&#x7684;&#x5220;&#x9664;&#x4E8B;&#x4EF6;</td>
<td>&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8282;&#x70B9; /lock,&#x8282;&#x70B9;&#x5DF2;&#x5B58;&#x5728;,&#x76D1;&#x542C; /lock &#x7684;&#x5220;&#x9664;&#x4E8B;&#x4EF6;</td>
</tr>
<tr>
<td>t3</td>
<td>&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5220;&#x9664; /lock &#x8282;&#x70B9;</td>
<td></td>
<td></td>
</tr>
<tr>
<td>t4</td>
<td></td>
<td>&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8282;&#x70B9; /lock&#xFF08;&#x6210;&#x529F;&#xFF09;</td>
<td>&#x5C1D;&#x8BD5;&#x521B;&#x5EFA;&#x8282;&#x70B9; /lock&#xFF08;&#x5931;&#x8D25;&#xFF09;</td>
</tr>
</tbody></table>
<ul>
<li>&#x4F18;&#x70B9;<ol>
<li>&#x7528;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#x5B9E;&#x73B0;&#xFF0C;&#x5373;&#x4F7F;&#x5BA2;&#x6237;&#x7AEF;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x4E4B;&#x540E;&#x5B95;&#x673A;&#x6CA1;&#x6709;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x4F46;&#x56E0;&#x4E3A;&#x662F;&#x4E34;&#x65F6;&#x8282;&#x70B9;&#xFF0C;&#x9501;&#x8282;&#x70B9;&#x8FD8;&#x662F;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x3002;</li>
</ol>
</li>
<li>&#x65B9;&#x6848;&#x7F3A;&#x70B9;<ol>
<li>&#x5982;&#x679C;&#x5E76;&#x53D1;&#x91CF;&#x5F88;&#x9AD8;&#xFF0C;&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x540C;&#x65F6;&#x76D1;&#x542C;&#x540C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#xFF0C;&#x91CA;&#x653E;&#x9501;&#x65F6;&#x540C;&#x65F6;&#x5524;&#x9192;&#x8FD9;&#x4E48;&#x591A;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7ADE;&#x4E89;&#xFF0C;&#x6700;&#x540E;&#x8FD8;&#x662F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x5176;&#x5B83;&#x5BA2;&#x6237;&#x7AEF;&#x53C8;&#x8981;&#x6C89;&#x7761;&#xFF0C;&#x8FD9;&#x4E9B;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x5524;&#x9192;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x610F;&#x4E49;&#xFF0C;&#x6781;&#x5927;&#x5730;&#x6D6A;&#x8D39;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x3002;</li>
</ol>
</li>
</ul>
<h4 id="&#x65B9;&#x6848;&#x4E8C;"><a href="#&#x65B9;&#x6848;&#x4E8C;" class="headerlink" title="&#x65B9;&#x6848;&#x4E8C;"></a>&#x65B9;&#x6848;&#x4E8C;</h4><p>&#x7528;&#x4E34;&#x65F6;&#x6709;&#x5E8F;&#x8282;&#x70B9;&#x548C;&#x8282;&#x70B9;&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;&#x5668;&#x6765;&#x5B9E;&#x73B0;&#xFF0C;&#x6BCF;&#x4E2A;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x670D;&#x52A1;&#x90FD;&#x9012;&#x589E;&#x6709;&#x5E8F;&#x7684;&#x521B;&#x5EFA;&#x8282;&#x70B9;&#xFF0C;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65F6;&#x5019;&#x770B;&#x81EA;&#x5DF1;&#x662F;&#x4E0D;&#x662F;&#x6700;&#x5C0F;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x662F;&#x7684;&#x8BDD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x4E0D;&#x662F;&#x7684;&#x8BDD;&#x76D1;&#x542C;&#x4E0A;&#x4E00;&#x4E2A;&#x6BD4;&#x4ED6;&#x5927;&#x7684;&#x8282;&#x70B9;&#x7684;&#x5220;&#x9664;&#x4E8B;&#x4EF6;&#x3002;&#x8FD9;&#x6837;&#x524D;&#x9762;&#x8282;&#x70B9;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5220;&#x9664;&#x8282;&#x70B9;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5524;&#x9192;&#x4E0B;&#x4E00;&#x4E2A;&#x5C31;&#x884C;&#x4E86;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x5524;&#x9192;&#x6240;&#x6709;&#x7B49;&#x5F85;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x8FD8;&#x662F;&#x5B9E;&#x73B0;&#x516C;&#x5E73;&#x9501;&#x3002;</p>
<ul>
<li><p>&#x4F18;&#x70B9;</p>
<p>&#x907F;&#x514D;&#x4E86;&#x60CA;&#x7FA4;&#x6548;&#x5E94;&#x3002;</p>
</li>
<li><p>&#x7F3A;&#x70B9;</p>
<p>&#x56E0;&#x4E3A;&#x8981;&#x521B;&#x5EFA;&#x5220;&#x9664;&#x8282;&#x70B9;&#xFF0C;&#x6027;&#x80FD;&#x76F8;&#x6BD4; Redis &#x5B9E;&#x73B0;&#x7684;&#x8981;&#x5DEE;&#x4E9B;&#x3002;</p>
</li>
</ul>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><h4 id="setnx"><a href="#setnx" class="headerlink" title="setnx"></a>setnx</h4><p><code>setnx</code> &#x547D;&#x4EE4;&#x662F;&#xFF0C;&#x5982;&#x679C; key &#x4E0D;&#x5B58;&#x5728;&#x5C31;&#x521B;&#x5EFA;&#x6210;&#x529F;&#xFF0C;&#x5B58;&#x5728;&#x521B;&#x5EFA;&#x5931;&#x8D25;&#x3002;</p>
<p>&#x5229;&#x7528;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#xFF0C;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x7ADE;&#x4E89;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x540C;&#x65F6;&#x8C03;&#x7528; <code>setnx</code> &#x547D;&#x4EE4;&#xFF0C;&#x53EA;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x8BBE;&#x7F6E;&#x6210;&#x529F;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x3002;&#x800C;&#x91CA;&#x653E;&#x9501;&#x5C31;&#x5220;&#x9664; <code>del</code> &#x8FD9;&#x4E2A; key &#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<img alt="setnx&#x52A0;&#x9501;&#x91CA;&#x653E;&#x9501;" style="zoom:50%;" data-src="/2019/09/26/&#x5206;&#x5E03;&#x5F0F;/image-20200227214335420.png" class="lozad">

<ul>
<li><p>&#x7F3A;&#x70B9;</p>
<p>&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x670D;&#x52A1;&#x6302;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x9501;&#x5C31;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x91CA;&#x653E;&#x4E86;&#x3002;</p>
</li>
</ul>
<h4 id="setnx-setex"><a href="#setnx-setex" class="headerlink" title="setnx+setex"></a>setnx+setex</h4><p>&#x9488;&#x5BF9;&#x4E0A;&#x9762;&#x7684;&#x7F3A;&#x70B9;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x60F3;&#x5230;&#xFF0C;&#x5982;&#x679C;&#x7ED9; key &#x52A0;&#x4E0A;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x90A3;&#x5373;&#x4F7F;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x670D;&#x52A1;&#x6302;&#x4E86;&#xFF0C;&#x9501;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#x4E5F;&#x4F1A;&#x91CA;&#x653E;&#x3002;</p>
<img alt="setnx+setex" style="zoom:50%;" data-src="/2019/09/26/&#x5206;&#x5E03;&#x5F0F;/image-20200227214359784.png" class="lozad">

<ul>
<li><p>&#x7F3A;&#x70B9;</p>
<p>&#x5982;&#x679C;&#x5728; setnx &#x4E4B;&#x540E; setex &#x4E4B;&#x524D;&#xFF0C;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x6302;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x662F;&#x4E0D;&#x4F1A;&#x91CA;&#x653E;&#x9501;&#x3002;</p>
</li>
</ul>
<h4 id="set-nx-ex"><a href="#set-nx-ex" class="headerlink" title="set nx ex"></a>set nx ex</h4><p>Redis &#x5728; 2.6 &#x63D0;&#x4F9B;&#x4E86; setnx+setex &#x7684;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x547D;&#x4EE4; <code>set nx ex</code>&#xFF0C;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;&#x547D;&#x4EE4;&#x7EC4;&#x5408;&#x8D77;&#x6765;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x89C4;&#x907F;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p><img alt="Set nx ex" data-src="/2019/09/26/&#x5206;&#x5E03;&#x5F0F;/image-20200227220725036.png" class="lozad"></p>
<p>&#x8FD9;&#x91CC; value &#x503C;&#x4E00;&#x822C;&#x4F1A;&#x8BBE;&#x8BA1;&#x6210;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x6570;&#xFF0C;&#x53EA;&#x6709;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x670D;&#x52A1;&#x624D;&#x77E5;&#x9053;&#x7684;&#x968F;&#x673A;&#x6570;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709; value &#x503C;&#xFF1A;&#x5982;&#x679C; A &#x83B7;&#x53D6;&#x5230;&#x4E86;&#x9501;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x5185;&#x6CA1;&#x6709;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x90A3;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#xFF0C;&#x9501;&#x88AB;&#x522B;&#x7684; B &#x83B7;&#x53D6;&#x5230;&#x4E86;&#xFF0C;&#x800C;&#x5728; B &#x6267;&#x884C;&#x4E1A;&#x52A1;&#x7684;&#x65F6;&#x5019;&#xFF0C;A &#x53C8;&#x53BB;&#x628A;&#x9501;&#x5220;&#x4E86;&#xFF08;&#x56E0;&#x4E3A;&#x4E0D;&#x7528;&#x6821;&#x9A8C; value&#xFF0C;&#x76F4;&#x63A5;&#x5C31;&#x5220;&#x4E86;&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x4E86;&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5728;&#x5220;&#x9664;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6267;&#x884C;&#x4E00;&#x6BB5;lua&#x811A;&#x672C;&#xFF0C;&#x628A;&#x8FD9;&#x6BB5;lua&#x811A;&#x672C;&#x5F53;&#x6210;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5148;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A;&#x9501;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x662F;&#x4E0D;&#x662F;&#x4E0A;&#x9762;&#x8BBE;&#x7F6E;&#x7684;&#x968F;&#x673A;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x518D;&#x6267;&#x884C;del&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5426;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x91CA;&#x653E;&#x9501;&#x5931;&#x8D25;&#x3002;</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// &#x52A0;&#x9501; </span><br><span class="line">SET resource_name my_random_value NX PX <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">// &#x91CA;&#x653E;&#x9501; </span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span> </span><br><span class="line">	<span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>]) </span><br><span class="line"><span class="keyword">else</span>    </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>&#x5982;&#x679C;&#x8FD9;&#x91CC;&#x7528; Java &#x5148; getValue &#x518D; del &#x4E5F;&#x4F1A;&#x6709;&#x5E76;&#x53D1;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x5728; getValue &#x68C0;&#x9A8C;&#x4E4B;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x9501;&#x8FC7;&#x671F;&#x88AB;&#x522B;&#x7684;&#x670D;&#x52A1;&#x83B7;&#x53D6;&#x4E86;&#xFF0C;&#x90A3;&#x5C31;&#x8FD8;&#x662F;&#x53C8;&#x95EE;&#x9898;&#x7684;&#x3002;</p>
<ul>
<li><p>&#x7F3A;&#x70B9;</p>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6848;&#x5DF2;&#x7ECF;&#x633A;&#x5B8C;&#x7F8E;&#x7684;&#x4E86;&#xFF0C;&#x5C31;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x600E;&#x4E48;&#x8BBE;&#x7F6E;&#xFF1F;&#x8BBE;&#x7F6E;&#x77ED;&#x4E86;&#xFF0C;&#x8FD8;&#x6CA1;&#x5904;&#x7406;&#x5B8C;&#x9501;&#x5C31;&#x6CA1;&#x4E86;&#xFF0C;&#x4F1A;&#x6709;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x8BBE;&#x7F6E;&#x957F;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x4E00;&#x76F4;&#x4E0D;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x9020;&#x6210;&#x6D6A;&#x8D39;&#x3002;</p>
</li>
</ul>
<h4 id="redlock"><a href="#redlock" class="headerlink" title="redlock"></a>redlock</h4><p>&#x4E0A;&#x9762;&#x8FD9;&#x51E0;&#x79CD;&#x5B58;&#x5728; Redis &#x670D;&#x52A1;&#x6302;&#x4E86;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x662F; Redis &#x5355;&#x5B9E;&#x4F8B;&#xFF0C;&#x90A3;&#x80AF;&#x5B9A;&#x5B58;&#x5728;&#x5355;&#x673A;&#x6545;&#x969C;&#x7684;&#x95EE;&#x9898;&#xFF1B;&#x5982;&#x679C;&#x662F;&#x4E3B;&#x4ECE;&#x67B6;&#x6784;&#xFF0C;&#x670D;&#x52A1; A &#x83B7;&#x53D6;&#x5230;&#x4E86;&#x9501;&#xFF0C;&#x4F46; Redis &#x4E3B;&#x4ECE;&#x5F02;&#x6B65;&#x590D;&#x5236;&#x8FD8;&#x6CA1;&#x590D;&#x5236;&#x5B8C;&#xFF0C;&#x4E3B;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x4ECE;&#x8282;&#x70B9;&#x5207;&#x6362;&#x5230;&#x4E3B;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x662F;&#x662F;&#x6CA1;&#x6709;&#x9501; key &#x7684;&#xFF0C;&#x90A3;&#x522B;&#x7684;&#x670D;&#x52A1;&#x4E5F;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#xFF0C;&#x5C31;&#x4F1A;&#x5B58;&#x5728;&#x5E76;&#x53D1;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;</p>
<p>redlock &#x83B7;&#x53D6;&#x9501;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>&#x5728;&#x4E0D;&#x540C;&#x7684;&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528;&#x5355;&#x4E2A;&#x5B9E;&#x4F8B;&#x83B7;&#x53D6;&#x9501;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x83B7;&#x5F97;&#x9501;&#xFF0C;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x90FD;&#x8981;&#x5728;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x5185;&#x521B;&#x5EFA;&#x6210;&#x529F;&#x624D;&#x53EF;&#x4EE5;&#xFF0C;&#x5F53;&#x5E94;&#x7528;&#x670D;&#x52A1;&#x6210;&#x529F;&#x83B7;&#x53D6;&#x9501;&#x7684; Redis &#x8282;&#x70B9;&#x8D85;&#x8FC7;&#x534A;&#x6570;&#x65F6;&#xFF0C;&#x5E76;&#x4E14;&#x83B7;&#x53D6;&#x9501;&#x6D88;&#x8017;&#x7684;&#x5B9E;&#x9645;&#x65F6;&#x95F4;&#x4E0D;&#x8D85;&#x8FC7;&#x9501;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x5219;&#x83B7;&#x53D6;&#x9501;&#x6210;&#x529F;&#x3002;</p>
<p>&#x8FD9;&#x6837;&#x5982;&#x679C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x4E3B;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x53E6;&#x5916;&#x7684;&#x670D;&#x52A1;&#x4E5F;&#x5C1D;&#x8BD5;&#x83B7;&#x53D6;&#x8FD9;&#x628A;&#x9501;&#xFF0C;&#x90A3;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x5728;&#x534A;&#x6570;&#x4EE5;&#x4E0A;&#x8282;&#x70B9;&#x4E0A;&#x521B;&#x5EFA;&#x9501;&#x7684; key&#xFF0C;&#x56E0;&#x4E3A;&#x8282;&#x70B9;&#x4E2D;&#x534A;&#x6570;&#x4EE5;&#x4E0A;&#x7684;&#x610F;&#x89C1;&#x6709;&#x4E86;&#x539F;&#x6765;&#x7684;&#x9501;&#x7684; key &#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x6210;&#x529F;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5C31;&#x7B97;&#x67D0;&#x4E2A;&#x4E3B;&#x8282;&#x70B9;&#x6302;&#x4E86;&#xFF0C;&#x522B;&#x7684;&#x670D;&#x52A1;&#x4E5F;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x3002;</p>
<h1 id="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"><a href="#&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;" class="headerlink" title="&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;"></a>&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;</h1><p>&#x5355;&#x673A;&#x7684;&#x4E8B;&#x52A1;&#x7531;&#x6570;&#x636E;&#x5E93;&#x4FDD;&#x8BC1; ACID&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x662F;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x901A;&#x8FC7;&#x6BCF;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x6837;&#x5728;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5C31;&#x6CA1;&#x6CD5;&#x901A;&#x8FC7;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4E8B;&#x52A1;&#x7279;&#x6027;&#x6765;&#x4FDD;&#x8BC1;&#x5206;&#x5E03;&#x5F0F;&#x64CD;&#x4F5C;&#x7684;&#x4E8B;&#x52A1;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x5C31;&#x9700;&#x8981;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x3002;</p>
<p>&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x5C31;&#x662F;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x64CD;&#x4F5C;&#x8981;&#x4E48;&#x90FD;&#x6210;&#x529F;&#xFF0C;&#x8981;&#x4E48;&#x5931;&#x8D25;&#x56DE;&#x6EDA;&#x3002;</p>
<h2 id="&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;-&#x5F3A;&#x4E00;&#x81F4;"><a href="#&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;-&#x5F3A;&#x4E00;&#x81F4;" class="headerlink" title="&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;(&#x5F3A;&#x4E00;&#x81F4;)"></a>&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;(&#x5F3A;&#x4E00;&#x81F4;)</h2><p>&#x6709;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x8D1F;&#x8D23;&#x534F;&#x8C03;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#xFF08;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x5668;&#xFF09;&#x7684;&#x4E8B;&#x52A1;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#xFF1A;&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x6D89;&#x53CA;&#x5230;&#x4E8B;&#x52A1;&#x7684;&#x6570;&#x636E;&#x5E93;&#x9884;&#x63D0;&#x4EA4;(precommit)&#x6B64;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x53CD;&#x6620;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#xFF1B;</p>
<p>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;&#xFF1A;&#x4E8B;&#x52A1;&#x534F;&#x8C03;&#x5668;&#x8981;&#x6C42;&#x6BCF;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#xFF0C;&#x6216;&#x8005;&#x56DE;&#x6EDA;&#x6570;&#x636E;&#x3002;</p>
<ul>
<li>&#x7F3A;&#x70B9;<ol>
<li>&#x6027;&#x80FD;&#x5DEE;&#xFF1B;</li>
<li>&#x4E00;&#x822C;&#x5206;&#x5E03;&#x5F0F;&#x67B6;&#x6784;&#xFF0C;&#x6BCF;&#x4E2A;&#x670D;&#x52A1;&#x90FD;&#x8BBF;&#x95EE;&#x81EA;&#x5DF1;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8FD9;&#x6837;&#x5938;&#x5E94;&#x7528;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x8FDD;&#x53CD;&#x5206;&#x5E03;&#x5F0F;&#x89C4;&#x5219;&#x3002;</li>
</ol>
</li>
</ul>
<h2 id="TCC-&#x5F3A;&#x4E00;&#x81F4;"><a href="#TCC-&#x5F3A;&#x4E00;&#x81F4;" class="headerlink" title="TCC(&#x5F3A;&#x4E00;&#x81F4;)"></a>TCC(&#x5F3A;&#x4E00;&#x81F4;)</h2><p>&#x5206;&#x5E03;&#x5F0F;&#x64CD;&#x4F5C;&#x5206;&#x4E3A; 3 &#x4E2A;&#x8282;&#x70B9;&#xFF1A;try&#x3001;confirm&#x3001;concel&#x3002;</p>
<ol>
<li><p>try&#x3002;&#x5BF9;&#x8BBE;&#x8BA1;&#x7684;&#x4E8B;&#x52A1;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x9501;&#x5B9A;&#xFF1B;</p>
</li>
<li><p>confirm&#x3002;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#xFF0C;&#x64CD;&#x4F5C;&#x9501;&#x5B9A;&#x7684;&#x6570;&#x636E;&#xFF1B;</p>
</li>
<li><p>cancel&#x3002;&#x5982;&#x679C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x4E1A;&#x52A1;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x51FA;&#x9519;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x91CC;&#x5C31;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x8865;&#x507F;&#x56DE;&#x6EDA;&#x3002;</p>
</li>
</ol>
<ul>
<li><p>&#x7F3A;&#x70B9;</p>
<p>&#x4E1A;&#x52A1;&#x4FB5;&#x5165;&#x4E25;&#x91CD;&#xFF0C;&#x96BE;&#x4EE5;&#x590D;&#x7528;&#x3002;</p>
</li>
</ul>
<h2 id="&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;-&#x6700;&#x7EC8;&#x4E00;&#x81F4;"><a href="#&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;-&#x6700;&#x7EC8;&#x4E00;&#x81F4;" class="headerlink" title="&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;(&#x6700;&#x7EC8;&#x4E00;&#x81F4;)"></a>&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;(&#x6700;&#x7EC8;&#x4E00;&#x81F4;)</h2><p>&#x8FD9;&#x79CD;&#x65B9;&#x6848;&#x4E0D;&#x80FD;&#x5B9E;&#x73B0;&#x5F3A;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4F46;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x3002;&#x5F3A;&#x4E00;&#x81F4;&#x6027;&#x5C31;&#x662F;&#x4EFB;&#x4F55;&#x65F6;&#x523B;&#x6570;&#x636E;&#x90FD;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x57FA;&#x4E8E; MQ &#x5B9E;&#x73B0;&#x3002;</p>
<ol>
<li>&#x670D;&#x52A1; A &#x5411; MQ &#x53D1;&#x9001; prepare &#x6D88;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x9001;&#x5931;&#x8D25;&#xFF0C;&#x76F4;&#x63A5;&#x540E;&#x9762;&#x7684;&#x64CD;&#x4F5C;&#x76F4;&#x63A5;&#x53D6;&#x6D88;&#xFF1B;</li>
<li>&#x53D1;&#x9001; prepare &#x6D88;&#x606F;&#x6210;&#x529F;&#x4E4B;&#x540E;&#xFF0C;A &#x518D;&#x64CD;&#x4F5C;&#x672C;&#x5730;&#x4E8B;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x6267;&#x884C;&#x5931;&#x8D25;&#x5C31;&#x544A;&#x8BC9; MQ &#x56DE;&#x6EDA;&#x6D88;&#x606F;&#xFF0C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x90FD;&#x4E0D;&#x518D;&#x6267;&#x884C;&#xFF1B;</li>
<li>A &#x672C;&#x5730;&#x4E8B;&#x52A1;&#x64CD;&#x4F5C;&#x6210;&#x529F;&#xFF0C;&#x5411; MQ &#x53D1;&#x9001;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#xFF0C;&#x5982;&#x679C; A &#x53D1;&#x9001;&#x4E86; prepare &#x6D88;&#x606F;&#xFF0C;&#x4F46;&#x4E00;&#x76F4;&#x4E0D;&#x53D1;&#x9001;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#xFF0C; MQ &#x4F1A;&#x81EA;&#x52A8;&#x5B9A;&#x65F6;&#x8F6E;&#x8BE2;&#x6240;&#x6709; prepared &#x6D88;&#x606F;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; A &#x7CFB;&#x7EDF;&#x4E8B;&#x5148;&#x63D0;&#x4F9B;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x53CD;&#x67E5; A &#x7CFB;&#x7EDF;&#x7684;&#x4E0A;&#x6B21;&#x672C;&#x5730;&#x4E8B;&#x52A1;&#x662F;&#x5426;&#x6267;&#x884C;&#x6210;&#x529F; &#x5982;&#x679C;&#x6210;&#x529F;&#xFF0C;&#x5C31;&#x53D1;&#x9001;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#x7ED9; MQ&#xFF1B;&#x5931;&#x8D25;&#x5219;&#x544A;&#x8BC9; MQ &#x56DE;&#x6EDA;&#x6D88;&#x606F;&#xFF1B;</li>
<li>MQ &#x6536;&#x5230;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#x540E;&#xFF0C;&#x4F1A;&#x518D;&#x53D1;&#x7ED9;&#x670D;&#x52A1; B&#xFF0C;B &#x6536;&#x5230;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#x5C31;&#x6267;&#x884C;&#x672C;&#x5730;&#x4E8B;&#x52A1;&#xFF0C;&#x5982;&#x679C; B &#x7684;&#x672C;&#x5730;&#x4E8B;&#x52A1;&#x6267;&#x884C;&#x5931;&#x8D25;&#xFF0C;MQ &#x4F1A;&#x4E00;&#x76F4;&#x53D1;&#x8FD9;&#x4E2A;&#x786E;&#x8BA4;&#x6D88;&#x606F;&#xFF0C;&#x76F4;&#x5230; B &#x5904;&#x7406;&#x6210;&#x529F;&#x3002;</li>
</ol>
<h2 id="&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x601D;&#x8003;"><a href="#&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x601D;&#x8003;" class="headerlink" title="&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x601D;&#x8003;"></a>&#x9879;&#x76EE;&#x4E2D;&#x7684;&#x601D;&#x8003;</h2><p>&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF; A &#x548C;&#x5DE5;&#x4F5C;&#x6D41;&#x7684;&#x5DE5;&#x5355;&#x7CFB;&#x7EDF; B&#xFF0C;&#x5728; A &#x4E2D;&#x9664;&#x4E86;&#x4E1A;&#x52A1;&#x5B57;&#x6BB5;&#xFF0C;&#x8FD8;&#x4FDD;&#x5B58;&#x4E86;&#x6392;&#x67E5;&#x5355;&#x7684;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#xFF0C;&#x662F;&#x5426;&#x5904;&#x7406;&#x5B8C;&#x6210;&#xFF0C;&#x5DE5;&#x5355;&#x4E2D;&#x7684; id &#x7B49;&#x4FE1;&#x606F;&#x3002;</p>
<ul>
<li><p>&#x65B9;&#x6848;&#x4E00;</p>
<ul>
<li><p>&#x4E1A;&#x52A1;&#x5458;&#x67E5;&#x8BE2;&#x81EA;&#x5DF1;&#x7684;&#x5F85;&#x529E;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x6839;&#x636E; A &#x4E2D;&#x7684;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#x67E5;&#x8BE2;&#x3002;</p>
</li>
<li><p>&#x4E1A;&#x52A1;&#x5BA1;&#x6279;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x4FEE;&#x6539; A &#x4E2D;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#xFF08;&#x8BBE;&#x7F6E;&#x4E3A;&#x4E0B;&#x4E00;&#x5904;&#x7406;&#x4EBA;&#xFF09;&#x7B49;&#x5B57;&#x6BB5;&#x4FE1;&#x606F;&#xFF0C;&#x4FEE;&#x6539; B &#x4E2D;&#x5DE5;&#x4F5C;&#x6D41;&#x7684;&#x4FE1;&#x606F;&#x3002;</p>
</li>
</ul>
<p>&#x603B;&#x7ED3;</p>
<p>&#x5B58;&#x5728;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x95EE;&#x9898;&#xFF0C;A &#x4FEE;&#x6539;&#x6210;&#x529F;&#xFF0C;B &#x5931;&#x8D25;&#xFF0C;&#x90A3;&#x4E48;&#x4E1A;&#x52A1;&#x5458;&#x53D1;&#x73B0;&#x5355;&#x5B50;&#x5DF2;&#x7ECF;&#x5904;&#x7406;&#x5B8C;&#x4E86;&#xFF0C;&#x5E76;&#x6D41;&#x8F6C;&#x5230;&#x4E0B;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x4EBA;&#xFF0C;&#x4F46;&#x4E0B;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x4EBA;&#x5904;&#x7406;&#x4E0D;&#x4E86;&#xFF08;&#x56E0;&#x4E3A;&#x5DE5;&#x4F5C;&#x6D41;&#x7CFB;&#x7EDF;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5BF9;&#xFF0C;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#x8FD8;&#x662F;&#x4E4B;&#x524D;&#x7684;&#x4E1A;&#x52A1;&#x5458;&#xFF09;&#x3002;</p>
</li>
<li><p>&#x65B9;&#x6848;&#x4E8C;</p>
<ul>
<li><p>&#x4E1A;&#x52A1;&#x5458;&#x67E5;&#x8BE2;&#x81EA;&#x5DF1;&#x7684;&#x5F85;&#x529E;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x6839;&#x636E; A &#x4E2D;&#x7684;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#x67E5;&#x8BE2;&#x3002;</p>
</li>
<li><p>&#x4E1A;&#x52A1;&#x5BA1;&#x6279;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x4FEE;&#x6539; A &#x4E2D;&#x5F53;&#x524D;&#x5904;&#x7406;&#x4EBA;&#xFF08;&#x8BBE;&#x7F6E;&#x4E3A;&#x4E0B;&#x4E00;&#x5904;&#x7406;&#x4EBA;&#xFF09;&#x7B49;&#x5B57;&#x6BB5;&#x4FE1;&#x606F;&#xFF0C;&#x4FEE;&#x6539; B &#x4E2D;&#x5DE5;&#x4F5C;&#x6D41;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C; B &#x5904;&#x7406;&#x5931;&#x8D25;&#xFF0C;&#x56DE;&#x6EDA; A &#x4E2D;&#x7684;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x3002;</p>
</li>
</ul>
<p>&#x603B;&#x7ED3;</p>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x6709;&#x70B9;&#x50CF; TCC&#xFF0C;&#x901A;&#x8FC7;&#x56DE;&#x6EDA;&#x8865;&#x507F;&#x6765;&#x4FDD;&#x8BC1;&#x4E8B;&#x52A1;&#xFF0C;&#x5C31;&#x662F;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#x3002;</p>
<p>&#x5982;&#x679C;&#x8D85;&#x65F6;&#x5931;&#x8D25;&#xFF0C;&#x901A;&#x8FC7;&#x8865;&#x507F;&#x7684;&#x65B9;&#x5F0F;&#x56DE;&#x6EDA;&#x4E86;&#xFF0C;&#x4F46;&#x539F;&#x6765;&#x63D0;&#x4EA4;&#x7684;&#x4EFB;&#x52A1;&#x5728;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4E4B;&#x5916;&#x53C8;&#x5904;&#x7406;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x662F;&#x5426;&#x4F1A;&#x5F15;&#x8D77;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x5462;&#xFF1F;</p>
</li>
<li><p>&#x65B9;&#x6848;&#x4E09;</p>
<ul>
<li><p>&#x4E1A;&#x52A1;&#x5458;&#x67E5;&#x8BE2;&#x81EA;&#x5DF1;&#x7684;&#x5F85;&#x529E;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x6839;&#x636E; B &#x4E2D;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x4FE1;&#x606F;&#x67E5;&#x8BE2;&#x81EA;&#x5DF1;&#x7684;&#x5F85;&#x529E;&#xFF0C;A &#x4E2D;&#x63A5;&#x53E3;&#x4E1A;&#x52A1;&#x53EA;&#x662F;&#x8C03;&#x4E00;&#x4E0B; B &#x7684;&#x63A5;&#x53E3;&#x3002;</p>
</li>
<li><p>&#x4E1A;&#x52A1;&#x5BA1;&#x6279;&#x6392;&#x67E5;&#x5355;</p>
<p>&#x76F4;&#x63A5;&#x53EA;&#x4FEE;&#x6539; B &#x4E2D;&#x5DE5;&#x4F5C;&#x6D41;&#x6570;&#x636E;&#x3002;</p>
</li>
</ul>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">mikasa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.shenlinqiang.com/2019/09/26/分布式/">http://www.shenlinqiang.com/2019/09/26/分布式/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.shenlinqiang.com">mikasaco</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/分布式锁/">分布式锁    </a><a class="post-meta__tags" href="/tags/分布式事务/">分布式事务    </a></div><div class="post_share"></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2019/10/08/源码解读-Map/"><img class="prev_cover lozad" data-src="/images/Map.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>源码解读-Map</span></div></a></div><div class="next-post pull-right"><a href="/2019/09/17/源码解读-迭代器/"><img class="next_cover lozad" data-src="/images/iterator.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>源码解读-迭代器</span></div></a></div></nav></div></div><footer style="background-image: url(/images/iterator.jpg)"><div id="footer"><div class="copyright">&copy;2018 - 2020 By mikasa</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="nightshift fa fa-moon-o" id="nightshift" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script>const observer = lozad(); // lazy loads elements with default selector as '.lozad'
observer.observe();
</script></body></html>